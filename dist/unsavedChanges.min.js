"use strict";angular.module("unsavedChanges",["resettable"]).provider("unsavedWarningsConfig",function(){var e=this;var t=false;var n=true;var r=["$locationChangeStart","$stateChangeStart"];var i="You will lose unsaved changes if you leave this page";var s="You will lose unsaved changes if you reload this page";Object.defineProperty(e,"navigateMessage",{get:function(){return i},set:function(e){i=e}});Object.defineProperty(e,"reloadMessage",{get:function(){return s},set:function(e){s=e}});Object.defineProperty(e,"useTranslateService",{get:function(){return n},set:function(e){n=!!e}});Object.defineProperty(e,"routeEvent",{get:function(){return r},set:function(e){if(typeof e==="string"){e=[e]}r=e}});Object.defineProperty(e,"logEnabled",{get:function(){return t},set:function(e){t=!!e}});this.$get=["$injector",function(e){function o(t){if(e.has("$translate")&&n){return e.get("$translate")(t)}else{return false}}var u={log:function(){if(console.log&&t&&arguments.length){var e=[].slice.call(arguments);if(typeof console.log==="object"){log.apply.call(console.log,console,e)}else{console.log.apply(console,e)}}}};Object.defineProperty(u,"useTranslateService",{get:function(){return n}});Object.defineProperty(u,"reloadMessage",{get:function(){return o(s)||s}});Object.defineProperty(u,"navigateMessage",{get:function(){return o(i)||i}});Object.defineProperty(u,"routeEvent",{get:function(){return r}});Object.defineProperty(u,"logEnabled",{get:function(){return t}});return u}]}).service("unsavedWarningSharedService",["$rootScope","unsavedWarningsConfig","$injector",function(e,t,n){function a(){s=true;angular.forEach(i,function(e,n){t.log("Form : "+e.$name+" dirty : "+e.$dirty);if(e.$dirty){s=false}});return s}function f(){t.log("No more forms, tearing down");angular.forEach(o,function(e){e()});window.onbeforeunload=null}function l(){t.log("Setting up");window.onbeforeunload=r.confirmExit;var n=t.routeEvent;angular.forEach(n,function(n){var r=e.$on(n,function(r,i,s){t.log("user is moving with "+n);if(!a()){t.log("a form is dirty");if(!confirm(u.navigate)){t.log("user wants to cancel leaving");r.preventDefault()}else{t.log("user doesn't care about loosing stuff");e.$broadcast("resetResettables")}}else{t.log("all forms are clean")}});o.push(r)})}var r=this;var i=[];var s=true;var o=[angular.noop];this.allForms=function(){return i};var u={navigate:t.navigateMessage,reload:t.reloadMessage};this.init=function(e){if(i.length===0){l()}t.log("Registering form",e);i.push(e)};this.removeForm=function(e){var n=i.indexOf(e);if(n===-1){return}i.splice(n,1);t.log("Removing form from watch list",e);if(i.length===0){f()}};this.confirmExit=function(){if(!a()){return u.reload}e.$broadcast("resetResettables");f()}}]).directive("unsavedWarningClear",["unsavedWarningSharedService",function(e){return{scope:{},require:"^form",priority:10,link:function(e,t,n,r){t.bind("click",function(e){r.$setPristine()})}}}]).directive("unsavedWarningForm",["unsavedWarningSharedService","$rootScope",function(e,t){return{scope:{},require:"form",link:function(n,r,i,s){e.init(s);r.bind("submit",function(e){if(s.$valid){s.$setPristine()}});r.bind("reset",function(e){e.preventDefault();n.$apply(t.$broadcast("resetResettables"));s.$setPristine()});n.$on("$destroy",function(){e.removeForm(s)})}}}]);angular.module("resettable",[]).directive("resettable",["$parse","$compile","$rootScope",function(e,t,n){return{scope:true,restrict:"A",link:function(n,r,i,s){var o,u,a;i.$observe("ngModel",function(t){u=e(i.ngModel);o=u.assign;a=u(n)});var f=function(){o(n,a)};var l=n.$on("resetResettables",f);n.$on("$destroy",l)}}}])