"use strict";angular.module("unsavedChanges",["resettable"]).provider("unsavedWarningsConfig",function(){var a=this,b=!1,c=!0,d=["$locationChangeStart","$stateChangeStart"],e="You will lose unsaved changes if you leave this page",f="You will lose unsaved changes if you reload this page";Object.defineProperty(a,"navigateMessage",{get:function(){return e},set:function(a){e=a}}),Object.defineProperty(a,"reloadMessage",{get:function(){return f},set:function(a){f=a}}),Object.defineProperty(a,"useTranslateService",{get:function(){return c},set:function(a){c=!!a}}),Object.defineProperty(a,"routeEvent",{get:function(){return d},set:function(a){"string"==typeof a&&(a=[a]),d=a}}),Object.defineProperty(a,"logEnabled",{get:function(){return b},set:function(a){b=!!a}}),this.$get=[function(){var a={log:function(){if(console.log&&b&&arguments.length){var a=[].slice.call(arguments);"object"==typeof console.log?log.apply.call(console.log,console,a):console.log.apply(console,a)}}};return Object.defineProperty(a,"useTranslateService",{get:function(){return c}}),Object.defineProperty(a,"reloadMessage",{get:function(){return f}}),Object.defineProperty(a,"navigateMessage",{get:function(){return e}}),Object.defineProperty(a,"routeEvent",{get:function(){return d}}),Object.defineProperty(a,"logEnabled",{get:function(){return b}}),a}]}).service("unsavedWarningSharedService",["$rootScope","unsavedWarningsConfig","$injector","$filter",function(a,b,c,d){function e(){return k=!0,angular.forEach(j,function(a){b.log("Form : "+a.$name+" dirty : "+a.$dirty),a.$dirty&&(k=!1)}),k}function f(){b.log("No more forms, tearing down"),angular.forEach(l,function(a){a()}),window.onbeforeunload=null}function g(a){if(c.has("$translate")&&b.useTranslateService){var e=d("translate");return e(a)}return a}function h(){b.log("Setting up"),window.onbeforeunload=i.confirmExit;var c=b.routeEvent;angular.forEach(c,function(c){var d=a.$on(c,function(d){b.log("user is moving with "+c),e()?b.log("all forms are clean"):(b.log("a form is dirty"),confirm(g(m.navigate))?(b.log("user doesn't care about loosing stuff"),a.$broadcast("resetResettables")):(b.log("user wants to cancel leaving"),d.preventDefault(),a.$broadcast("unsavedFormStay")))});l.push(d)})}var i=this,j=[],k=!0,l=[angular.noop];this.allForms=function(){return j};var m={navigate:b.navigateMessage,reload:b.reloadMessage};this.init=function(a){0===j.length&&h(),b.log("Registering form",a),j.push(a)},this.removeForm=function(a){var c=j.indexOf(a);-1!==c&&(j.splice(c,1),b.log("Removing form from watch list",a),0===j.length&&f())},this.confirmExit=function(){return e()?(a.$broadcast("resetResettables"),void f()):g(m.reload)}}]).directive("unsavedWarningClear",["unsavedWarningSharedService",function(){return{require:"^form",priority:10,link:function(a,b,c,d){b.bind("click",function(){d.$setPristine()})}}}]).directive("unsavedWarningForm",["unsavedWarningSharedService","$rootScope",function(a,b){return{require:"form",link:function(c,d,e,f){a.init(f),d.bind("submit",function(){f.$valid&&f.$setPristine()}),d.bind("reset",function(a){a.preventDefault(),c.$apply(b.$broadcast("resetResettables")),f.$setPristine()}),c.$on("$destroy",function(){a.removeForm(f)})}}}]),angular.module("resettable",[]).directive("resettable",["$parse","$compile","$rootScope",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g;d.$observe("ngModel",function(){f=a(d.ngModel),e=f.assign,g=f(b)});var h=function(){e(b,g)},i=b.$on("resetResettables",h);b.$on("$destroy",i)}}}]);